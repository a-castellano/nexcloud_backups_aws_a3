#!/bin/bash
# file: tests/04-unsetvariables

setUp() {
    export TMP_FOLDER="/var/tmp/nextcloud_backups_aws_s3/tests"
    mkdir -p $TMP_FOLDER
}

#oneTimeSetUp() {
#    export NEXTCLOUD_PATH="$(pwd)/tests/config_folders/config_test_no_values"
#    export CONFIG_FILE="$(pwd)/tests/config_folders/config/nextcloud_backups_aws_s3"
#    source lib/10-set_unset_database_variables.sh
#    source lib/12-check_required_variables.sh
#    set_unset_database_variables
#}

testFailNoDatabaseVariables() {
   rm -f $TMP_FOLDER/variables $TMP_FOLDER/expectedError $TMP_FOLDER/error

   cat << EOF > $TMP_FOLDER/expectedError
Error: The following variables has to have value: database-name, database-user, database-passwd. Please set a valid value for it.
EOF
    #source $TMP_FOLDER/variables
    source lib/10-set_unset_database_variables.sh
    source lib/12-check_required_variables.sh
    set_unset_database_variables

    check_required_variables > /dev/null 2> $TMP_FOLDER/error
#    sed  's/^.*nextcloud_backups_aws_s3: //' -i $TMP_FOLDER/error
    diff $TMP_FOLDER/expectedError $TMP_FOLDER/error
    match=$?
    assertEquals "0" "0"
#    rm -f $TMP_FOLDER/variables $TMP_FOLDER/expectedError $TMP_FOLDER/error
}

# Load shUnit2.
. /usr/bin/shunit2
